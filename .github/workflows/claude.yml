name: Claude Code

on:
  # Respond to @claude mentions in comments
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]

  # Automatically review new PRs
  pull_request:
    types: [opened]

jobs:
  claude:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch full history for git operations

      - uses: anthropics/claude-code-action@v1.0.16
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          prompt: |
            Provide an initial assessment and summary of this PR:
            1. What does this PR accomplish?
            2. What are the key changes?
            3. Are there any security concerns?
            4. Are there any architectural concerns?
            5. Does it follow the project's code quality standards?

            Keep your review concise and actionable.
